<div id="chat-box" style="height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;"></div>
<input id="chat-input" placeholder="è¼¸å…¥è¨Šæ¯..." />
<button id="send-btn">é€å‡º</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "ä½ çš„ apiKey",
    authDomain: "ä½ çš„ authDomain",
    projectId: "ä½ çš„ projectId",
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const chatBox = document.getElementById("chat-box");
  const chatInput = document.getElementById("chat-input");
  const sendBtn = document.getElementById("send-btn");

  // ğŸ”¹ ç›£è½è¨Šæ¯è®ŠåŒ–
  const chatQuery = query(collection(db, "chat"), orderBy("time", "asc"));
  onSnapshot(chatQuery, (snapshot) => {
    chatBox.innerHTML = "";
    snapshot.forEach((doc) => {
      const data = doc.data();
      const msg = document.createElement("div");
      const date = data.time?.toDate().toLocaleString() || "";
      msg.textContent = `[${data.role || "æœªçŸ¥"}] ${data.name}: ${data.message} (${date})`;
      chatBox.appendChild(msg);
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  });

  // ğŸ”¹ é€å‡ºè¨Šæ¯
  sendBtn.onclick = async () => {
    const user = auth.currentUser;
    if (!user) return alert("è«‹å…ˆç™»å…¥ï¼");
    const text = chatInput.value.trim();
    if (!text) return;
    await addDoc(collection(db, "chat"), {
      name: user.displayName,
      message: text,
      role: "å­¸ç”Ÿ", // å¯ä»¥æ ¹æ“šä½ çš„ç™»å…¥æ¬Šé™è‡ªå‹•æŒ‡å®š
      time: serverTimestamp(), // âœ… ç”¨ Timestamp å„²å­˜
    });
    chatInput.value = "";
  };
</script>
